// Generated by CoffeeScript 1.7.1
(function() {
  angular.module('nd-angular.sessions').factory('CurrentSession', [
    'Session', '$location', function(Session, $location) {
      var service;
      return service = {
        user: null,
        requestUser: function() {
          return Session.get().then(function(session) {
            return service.user = session.user;
          });
        },
        create: function(login, password, success, error) {
          var authenticated;
          authenticated = function(session) {
            service.user = session.user;
            if (success) {
              return success();
            }
          };
          return new Session({
            login: login,
            password: password
          }).create().then(authenticated, error);
        },
        destroy: function() {
          return Session.$delete('/api/sessions').then(function() {
            service.user = null;
            return $location.path('/sign_in');
          });
        },
        can: function(action, resource) {
          var ab, _i, _len, _ref;
          if (!(service.user && service.user.abilities)) {
            return false;
          }
          _ref = service.user.abilities;
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            ab = _ref[_i];
            if (ab.action === action && ab.resource === resource) {
              return true;
            }
          }
          return false;
        }
      };
    }
  ]);

}).call(this);
